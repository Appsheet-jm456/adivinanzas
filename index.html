<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Adivinanzas · Kinetic English</title>
  <style>
    :root{
      /* Identidad Kinetic */
      --brand-primary:#32D6E3; /* turquesa */
      --brand-dark:#4A4A4A;    /* gris oscuro */
      --brand-light:#D9D9D9;   /* gris claro */
      /* UI base */
      --bg:#0b0f19;           
      --card:#0f1627f0; 
      --text:#e8f1f6;
      --muted:#a8b3c7;
      --accent:var(--brand-primary);
      --wrong:#ef4444;
      --button:#1b2336;
      --border:#2b3a55;
    }
    *{box-sizing:border-box}
    body{margin:0;min-height:100vh;display:grid;place-items:center;background:radial-gradient(1200px 600px at 10% -20%,#1f2a44,transparent),var(--bg);color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Ubuntu,Helvetica,Arial,sans-serif;padding:24px;font-size:18px}
    .container{width:min(1100px,100%);display:grid;gap:18px}
    header{display:flex;justify-content:space-between;align-items:center;gap:14px}
    h1{font-size:clamp(36px,5.5vw,56px);margin:0;font-weight:800;letter-spacing:.2px;color:var(--brand-primary)}
    h2{font-size:clamp(24px,3.2vw,34px);font-weight:800;margin:10px 0 6px}
    .card{background:var(--card);backdrop-filter:blur(6px);border:2px solid var(--border);border-radius:22px;padding:22px;box-shadow:0 18px 40px #0006}
    .row{display:flex;gap:14px;flex-wrap:wrap;align-items:center}
    .muted{color:var(--muted);font-size:16px}
    input[type="text"]{flex:1;min-width:260px;background:#0b1220;color:var(--text);border:2px solid var(--border);border-radius:14px;padding:14px 16px;font-size:20px;outline:none}
    input[type="text"]:focus{border-color:var(--brand-primary);box-shadow:0 0 0 4px #32d6e333}
    button{background:var(--button);color:var(--text);border:2px solid var(--border);border-radius:14px;padding:12px 18px;font-size:18px;cursor:pointer;font-weight:700}
    button:hover{filter:brightness(1.08)}
    .btn-primary{background:var(--brand-primary);border-color:#15b5c2;color:#06242a}
    .tag{display:inline-block;border:2px dashed var(--border);border-radius:999px;padding:8px 12px;font-size:14px}
    .status{font-weight:800}
    .status.ok{color:var(--accent)}
    .status.bad{color:var(--wrong)}
    .img-wrap{display:grid;place-items:center;margin:10px 0}
    .img-wrap img{max-width:100%;border-radius:16px;border:2px solid var(--border)}
    .progress{height:10px;background:#0b1220;border:2px solid var(--border);border-radius:999px;overflow:hidden}
    .progress>div{height:100%;background:linear-gradient(90deg,var(--brand-primary),#60a5fa);width:0%}
    .pill{display:flex;align-items:center;gap:10px;padding:8px 14px;border-radius:999px;background:#0b1220;border:2px solid var(--border);font-weight:700}
    .pill .small{font-weight:600;color:var(--muted);font-size:14px}
    footer{display:flex;justify-content:space-between;flex-wrap:wrap;gap:10px}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}

    /* Overlay PIN */
    .gate{position:fixed;inset:0;background:rgba(5,8,15,.92);display:grid;place-items:center;z-index:50}
    .gate .panel{background:var(--card);border:2px solid var(--border);border-radius:22px;padding:28px;max-width:520px;width:90%;text-align:center;box-shadow:0 20px 50px #0009}
    .gate h3{margin:0 0 10px 0;font-size:clamp(24px,4vw,36px);font-weight:800;color:var(--brand-primary)}
    .gate p{color:var(--muted);margin:0 0 14px 0}
    .gate input{width:100%;background:#0b1220;color:var(--text);border:2px solid var(--border);border-radius:14px;padding:12px 14px;font-size:20px}
    .gate button{margin-top:12px;width:100%}
  </style>
</head>
<body>
  <!-- Overlay de PIN -->
  <div class="gate" id="gate">
    <div class="panel">
      <h3>Ingresa tu PIN</h3>
      <p>Clave para iniciar el juego</p>
      <input id="pinInput" type="password" placeholder="PIN"/>
      <button id="pinBtn" class="btn-primary">Entrar</button>
      <div class="muted" id="pinMsg" style="margin-top:8px"></div>
    </div>
  </div>

  <div class="container" id="gameWrap" style="display:none">
    <header>
      <h1 id="game-title">Adivinanzas</h1>
      <div class="pill">
        <div><strong id="points">0</strong>/<span id="maxpoints">0</span> pts</div>
        <div class="small">Progreso: <span id="done">0</span>/<span id="total">0</span></div>
      </div>
    </header>

    <div class="card" id="card">
      <div class="muted" id="category">Tema: —</div>

      <div class="img-wrap" id="imageWrap" hidden>
        <img id="image" alt="Imagen de pista" loading="lazy" />
      </div>

      <h2 id="riddle"></h2>

      <div class="row">
        <label class="sr-only" for="answer">Tu respuesta</label>
        <input type="text" id="answer" placeholder="Escribe tu respuesta" autocomplete="off" />
        <button class="btn-primary" id="checkBtn">Comprobar</button>
      </div>

      <div class="row" style="margin-top:8px">
        <button id="hint1Btn">Pista 1</button>
        <button id="hint2Btn">Pista 2</button>
        <div class="tag">Puntaje: 100 sin pistas · 50 con 1 · 25 con 2</div>
      </div>

      <div class="row" style="justify-content:space-between;margin-top:10px">
        <div class="muted" id="hint"></div>
        <div class="status" id="status"></div>
      </div>

      <div class="progress" style="margin-top:14px"><div id="bar"></div></div>
    </div>

    <footer class="muted">
      <div>
        © Kinetic English — Plantilla libre de uso
      </div>
    </footer>
  </div>

  <!-- Audios opcionales -->
  <audio id="snd-correct" preload="auto"></audio>
  <audio id="snd-wrong" preload="auto"></audio>
  <audio id="snd-click" preload="auto"></audio>
  <audio id="snd-hint" preload="auto"></audio>

  <script>
    /* ==========================
       🔧 CONFIGURACIÓN RÁPIDA
       ========================== */
    const CONFIG = {
      title: "Kinetic English · Adivinanzas",
      category: "Módulo 1 · Vocabulario: Animales",
      allowAccentFree: true,
      gate: { enabled: true, pin: "2025" }, // PIN para iniciar
      // Sonidos (sube tus mp3 a assets/sfx/ y pon las rutas)
      sounds: { correct: "", wrong: "", click: "", hint: "" },
      messages: { correct: "¡Excelente! ¡Lo lograste!", incorrect: "Sigue intentando, ¡tú puedes!" },
      items: [
        { clue: "Tengo rayas blancas y negras, y parezco caballo. ¿Quién soy?", answer: "cebra", hint1: "Comienza por 'ce'...", hint2: "Vive en África.", image: "assets/img/cebra.jpg" },
        { clue: "No soy gato ni perro, digo 'muuu' y doy leche.", answer: "vaca", hint1: "Rima con 'taca'", hint2: "Animal de granja.", image: "" },
        { clue: "Vuelo sin alas y lloro sin ojos. ¿Qué soy?", answer: "nube", hint1: "A veces tapa el sol", hint2: "Está en el cielo.", image: "assets/img/nube.jpg" }
      ]
    };

    /* ==========================
       🚀 LÓGICA DEL JUEGO
       ========================== */
    const titleEl = document.getElementById('game-title');
    const categoryEl = document.getElementById('category');
    const riddleEl = document.getElementById('riddle');
    const imageWrap = document.getElementById('imageWrap');
    const imageEl = document.getElementById('image');
    const answerEl = document.getElementById('answer');
    const statusEl = document.getElementById('status');
    const hintEl = document.getElementById('hint');
    const barEl = document.getElementById('bar');

    const pointsEl = document.getElementById('points');
    const maxpointsEl = document.getElementById('maxpoints');
    const doneEl = document.getElementById('done');
    const totalEl = document.getElementById('total');

    const checkBtn = document.getElementById('checkBtn');
    const hint1Btn = document.getElementById('hint1Btn');
    const hint2Btn = document.getElementById('hint2Btn');

    const SND = {
      correct: document.getElementById('snd-correct'),
      wrong: document.getElementById('snd-wrong'),
      click: document.getElementById('snd-click'),
      hint: document.getElementById('snd-hint'),
    };

    function initSounds(){
      if(CONFIG.sounds?.correct) SND.correct.src = CONFIG.sounds.correct;
      if(CONFIG.sounds?.wrong)   SND.wrong.src   = CONFIG.sounds.wrong;
      if(CONFIG.sounds?.click)   SND.click.src   = CONFIG.sounds.click;
      if(CONFIG.sounds?.hint)    SND.hint.src    = CONFIG.sounds.hint;
    }
    function play(name){ try{ SND[name]?.currentTime = 0; SND[name]?.play(); }catch(e){} }

    const normalize = (s) => CONFIG.allowAccentFree
      ? s.normalize('NFD').replace(/[\u0300-\u036f]/g, '').toLowerCase().trim()
      : s.toLowerCase().trim();

    let index = 0;
    let totalScore = 0;
    let hintLevel = 0; // 0: sin pistas (100) · 1: una pista (50) · 2: dos pistas (25)

    const items = CONFIG.items.map(v=>({v,r:Math.random()})).sort((a,b)=>a.r-b.r).map(({v})=>v);
    const MAX_POINTS = items.length * 100;

    function setProgress(){
      const pct = ((index) / items.length) * 100;
      barEl.style.width = pct + '%';
      pointsEl.textContent = totalScore;
      maxpointsEl.textContent = MAX_POINTS;
      doneEl.textContent = Math.min(index, items.length);
      totalEl.textContent = items.length;
    }

    function loadItem(){
      const it = items[index];
      if(!it){
        riddleEl.textContent = '¡Juego completado!';
        statusEl.textContent = `Puntuación final: ${totalScore} de ${MAX_POINTS}`;
        hintEl.textContent = '';
        answerEl.disabled = true;
        checkBtn.disabled = true;
        hint1Btn.disabled = true;
        hint2Btn.disabled = true;
        return;
      }
      titleEl.textContent = CONFIG.title || 'Adivinanzas';
      categoryEl.textContent = CONFIG.category || '—';
      riddleEl.textContent = it.clue;
      hintEl.textContent = '';
      statusEl.textContent = '';
      answerEl.value = '';
      answerEl.focus();
      hintLevel = 0;
      hint1Btn.disabled = false; hint2Btn.disabled = false;
      if(it.image){ imageEl.src = it.image; imageWrap.hidden = false; } else { imageWrap.hidden = true; }
      setProgress();
    }

    function pointsFor(h){ return h===0?100 : h===1?50 : 25; }

    function check(){
      const it = items[index]; if(!it) return;
      const got = normalize(answerEl.value);
      const ok = normalize(it.answer) === got;
      if(ok){
        const earned = pointsFor(hintLevel);
        totalScore += earned;
        statusEl.textContent = `${CONFIG.messages?.correct || '¡Correcto!'} (+${earned} pts)`;
        statusEl.className = 'status ok';
        play('correct');
      }else{
        statusEl.textContent = `${CONFIG.messages?.incorrect || 'Incorrecto.'} Respuesta: ${it.answer} (+0 pts)`;
        statusEl.className = 'status bad';
        play('wrong');
      }
      index++;
      setProgress();
      setTimeout(loadItem, 900);
    }

    function showHint(level){
      const it = items[index]; if(!it) return;
      if(level === 1){
        hintEl.textContent = it.hint1 ? `💡 ${it.hint1}` : 'Sin pista 1.';
        hintLevel = Math.max(hintLevel,1);
        hint1Btn.disabled = true; play('hint');
      }else{
        hintEl.textContent = (it.hint1||it.hint2) ? `${it.hint1?`💡 ${it.hint1}\n`:''}${it.hint2?`✨ ${it.hint2}`:''}` : 'Sin pista 2.';
        hintLevel = 2; hint1Btn.disabled = true; hint2Btn.disabled = true; play('hint');
      }
    }

    // ======= Acceso con PIN =======
    function initGate(){
      if(!CONFIG.gate?.enabled){ document.getElementById('gameWrap').style.display='block'; loadItem(); return; }
      const params=new URLSearchParams(window.location.search);
      const urlPin=params.get('pin');
      if(urlPin && urlPin===String(CONFIG.gate.pin)){
        document.getElementById('gate').style.display='none';
        document.getElementById('gameWrap').style.display='block';
        loadItem(); return;
      }
      const pinBtn=document.getElementById('pinBtn');
      const pinInput=document.getElementById('pinInput');
      const pinMsg=document.getElementById('pinMsg');
      function checkPin(){
        if(pinInput.value===String(CONFIG.gate.pin)){
          document.getElementById('gate').style.display='none';
          document.getElementById('gameWrap').style.display='block';
          play('click'); loadItem();
        } else { pinMsg.textContent='PIN incorrecto'; }
      }
      pinBtn.onclick=checkPin; pinInput.onkeydown=e=>{if(e.key==='Enter')checkPin();};
    }

    // Eventos
    answerEl.addEventListener('keydown', (e)=>{ if(e.key==='Enter') check(); });
    checkBtn.addEventListener('click', check);
    hint1Btn.addEventListener('click', ()=>showHint(1));
    hint2Btn.addEventListener('click', ()=>showHint(2));

    // Inicio
    initSounds();
    setProgress();
    initGate();
  </script>
</body>
</html>
